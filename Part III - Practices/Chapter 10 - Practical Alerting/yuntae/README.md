# Chapter 10 - Practical Alerting

알람(alert)은 시스템이 이상 상태일 때 적절히 대응하기 위한 수단.  
그런데 ‘언제, 어떤 조건에서 알람을 울릴 것인가’를 잘못 설정하면 오히려 더 큰 혼란을 초래함.  
=> 알람은 ‘행동(action)’을 유도해야 하며, 불필요한 알람은 피로도만 유발함.

## Alert는 ‘증상(Symptom)’ 중심으로

내부 지표(metric)가 아니라 사용자 경험에 가까운 증상 중심으로 설정해야 함.  
→ CPU 사용률이 99%인 것보다 “/login 요청의 성공률이 90% 미만”이 더 현실적인 알람.

> [!NOTE]  
> 단순 metric 기준으로 대응했는데 실제 유저는 문제없었고, 로그만 쌓이는 상황.  
> 반면 `/api/auth`의 5xx 증가를 기준으로 PromQL 처리해서 alert를 하면 효과적으로 대응.  
> 증상 중심 alert.

## 알람의 필수 요건

1. **Actionable (대응 가능)**

   - 알람이 떴을 때 “그래서 뭘 하면 되는데?”라는 질문에 명확한 답이 있어야 함.
   - 그렇지 않으면 알람이 아니라 그냥 시끄러운 로그.

2. **페이지가 울리는 알람은 최소화**
   - 모든 알람이 항상 울릴 필요 없음.
   - 진짜 중요한 것만 사람을 깨워야 함 (특히 새벽엔…)

> [!TIP] Alert Level 설계
>
> - critical: pager, 즉시 대응
> - warning: Slack 기록만, 추후 확인
> - info: 단순 로그 기록

## Borgmon, Prometheus

- Borgmon은 Google 내부에서 사용되던 시계열 기반 모니터링 시스템.

  - 경보를 위한 쿼리 언어와 템플릿 기능 포함
  - 자동화된 알람 무음 처리(silencing), 히스토리 관리 등 포함

- Prometheus는 Borgmon의 개념을 이어받아 오픈소스로 발전
  - PromQL로 조건 표현, Alertmanager로 그룹핑/무음 처리 가능
  - 단점: UI나 권한 관리 등은 외부 구성 필요 (Grafana 등과 연동)

> [!NOTE]  
> 개인적으로 Prometheus의 가장 좋은 점은 PromQL이라는 문법으로 **복잡한 조건을 쿼리로 명확히 정의할 수 있다는 점.**

## Alert system design

- **알람은 행동을 유도해야 함**

  - 그 자체로 Runbook 링크가 될 수 있을 정도로 설명이 명확해야 함

- **기준이 명확하고, 거짓 양성(false positive)을 최소화할 것**

  - 사용자 영향이 없는데 알람 울리면 대응 리소스 낭비됨

- **지속적으로 관리할 것**
  - 알람이 너무 자주 울리면 mute → 근본 원인 해결 or 기준 조정
  - 6개월 이상 의미 없는 알람은 제거 대상

## Thoughts

알람은 많을수록 좋은 게 아니다. 오히려 **적고 정제된 알람이 가장 강력하다.**
지만, 그냥 작은 시스템에서는 빠른 확인을 위해 주기적으로 울려도 개인적으로는 크게 문제가 없는 듯.
