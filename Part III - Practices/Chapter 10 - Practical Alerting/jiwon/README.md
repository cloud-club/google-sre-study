---
writer: jiwon
date: 2025-04-06
---

# Chapter 10 - Practical Alerting

## Summary

- 모니터링은 안정적인 서비스를 운영하기 위해 반드시 필요한 기본 구성요소
  - 변경 사항의 영향을 합리적으로 결정
  - 장애 발생 시 과학적인 방법으로 데체 가능
- 초대형 시스템의 모니터링이 어려운 이유
  - 분석해야 할 컴포넌트의 수를 정확히 알아야 함
  - 각 시스템에 대한 엔지니어들의 책임 부담을 최대한 낮추어야 함
- 한 지역의 전체 평균 응답 시간 < 한 지역의 전체에 분산되는 응답 시간의 양상
  - 지연 응답의 증가를 유발하는 요인들을 정확히 파악 가능
- 릴리즈 시 개별 머신의 실패에 대한 알람 < 종합적인 신호를 전달하여 외부 요인을 배제
  - 고수준의 서비스 목표에 대한 알림을 제공하면서도 개별 컴포넌트를 필요에 따라 살펴볼 수 있도록 세분화
- 체크 스크립트는 시계열 데이터를 토대로 차트와 알림을 생성할 수 있는 언어도 대체됨

### 보그몬

- 모니터링 시스템
- 시스템의 장애를 탐지하기 위해 스크립트를 실행하는 것이 아니라 공용 데이터 해설 형식을 이용
  - 낮은 오버헤드로 대량의 데이터를 수집할 수 있음
  - 데이터 처리 프로세스의 실행과 네트워크 연결 설정에 따른 비용을 없앰
  - 보그몬은 화이트박스 모니터링 도구
- 데이터는 차트의 렌더링과 알림 생성에 사용되며, 간단한 수학적 연산을 통해 이루어짐
- 보그몬은 다른 보그몬의 데이터를 수집할 수 있음
  - 기반 클러스터를 여러 개의 보그몬 인스턴스에 샤드하여 클러스터 수준에서 실행되는 보그몬의 데이터를 수집할 수 있음
- 보그몬 인스턴스는 자신의 대상을 찾기 위한 대상 리스트를 지님
  - 대상 리스트는 동적이기에 서비스 탐색을 이용허여 모니터링 시스템을 손쉽게 스케일링하고 운영 비용을 줄일 수 있음
- 각 대상을 인식하기 위한 통합적 변수들
  1. 대상의 이름이 호스트와 포트 번호로 해석 되었는지 여부
  2. 대상이 데이터 수집에 응답했는지 여부
  3. 대상이 건강 상태 점검 요청에 응답했는지 여부
  4. 데이터 수집이 완료한 시각
- 이러한 통합적 변수들을 통해 모니터링 중인 작업의 상태를 감지하기 위한 규칙을 손쉽게 작성 가능
- 시스템 자체가 네트워크와 머신의 실패에 잘 대응할 수 있도록 디자인 되어 있으면, 보그몬의 실패 자체도 하나의 신호로 수집하여 알림을 발송하기 위한 규칙을 작성 가능함
- 보그몬은 모든 데이터를 인메모리 데이터베이스에 저장한다.
  - 이 데이터베이스는 정기적으로 디스크에 다시 저장된다.
- 메모리 내의 상태는 정기적으로 TSDB에 저장된다
  - 보그몬의 RAM 보다는 상대적으로 느리지만 저렴한 비용으로 많은 데이터를 보관할 수 있다.
- 시계열 데이터베이스 내의 데이터는 식별 가능해야 하기에 최소한 다음의 레이블들을 필요로 한다.
  - var : 변수 이름
  - job : 모니터링되는 서버의 타입의 이름
  - service : 사용자에게 서비스를 제공하는 내부 및 외부 잡의 느슨하게 정의된 집합
  - zone : 변수가 수집된 보그몬의 이름. 보통 지역
- 정해진 범위의 시간을 사용하여 분석
  - 미분이나 적분을 사용하는 것보다 훨씬 쉽게 비율을 계산 할 수 있음
  - 다만, 충분한 양의 데이터가 필요하고
  - 최근 데이터 중 일부는 수집하지 못할 수도 있음

### 알림

- 알림 규칙을 설정하고 그 결과가 참이면 발송하는 방식
  - 근데 알림의 상태는 금세 바뀔 수 있음
  - 그래서 알림을 보내기 전 일정 시간 반드시 참이어야 하는 조건을 추가하여 보완 가능
- 보그몬은 alertmanager이라는 중앙 집중식으로 운영되는 서비스에 연결됨
  - 이 서비스는 알림 규칙에 따라 알림이 처음 생성될 때와 그 후 실제 알림이 발송 될 때의 알림 RPC 메시지를 수신함
- 모니터링 시에는 서비스 내부의 상태 파악을 위한 화이트 박스 + 소비자의 관점에서의 상태 파악을 위한 블랙 박스 모니터링 시스템이 필요
  - 블랙 박스 모니터링은 프로토콜의 응답 페이로드의 유효성 검사 등의 방법으로 가능

## Questions
<!-- 읽으며 궁금했던 점 -->

## Thoughts
<!-- 내 생각 -->

## Difficulties
<!-- 어려웠던 점 -->

## References
<!-- 추가 찾아본 레퍼런스 -->

## Discussion Topics
<!-- 다른 사람의 의견이 궁금한 부분 -->