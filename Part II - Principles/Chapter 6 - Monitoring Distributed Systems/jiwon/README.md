---
writer: jiwon
date: 2025-03-23
---

# Chapter 6 - Monitoring Distributed Systems

## Summary
### 용어 정의
- 모니터링
  - 서버의 활동 시간 등 시스템에 대한 정량적 실시간 데이터를 모으고 처리하고, 집계하여 보여주는 것
- 화이트박스 모니터링
  - 인터페이스 혹은 HTTP 핸드럴 등을 통해 얻은 시스템의 내부 지표들을 토대로 하는 모니터링
- 블랙박스 모니터링
  - 사용자가 보게 되는 확인 가능한 동작들을 외부에서 테스트하는 과정
### 모니터링을 해야 하는 이유
- 시간순 혹은 그룹에 따른 서비스 분석
- 임시적인 회고 분석의 수행(디버깅)
- 모니터링과 알림을 통해 시스템에 언제 문제가 발생했는지, 어떤 문제가 발생하려 하는지 알 수 있다.
- 효과적인 알림 시스템은 정확한 신호와 낮은 오보 비율을 갖춰야 한다.
  - 호출은 사람에게 부하가 큰 일이다.
  - 알림 비율을 낮게 유지하고 알림을 명확하게 표현할 수 있어야 한다.
### 블랙 박스와 화이트 박스
- 중요도가 낮은 서비스 - 화이트박스 모니터링
- 중요한 서비스 - 블랙박스 모니터링
- 블랙박스 모니터링
  - 서버 상에 나타나는 증상을 기본으로 하며 현재 문제가 발생하는 상황을 모니터링 하는 것
- 화이트박스 모니터링
  - 로그나 HTTP 종단점같은 시스템의 내부 동작들을 규범에 따라 살펴보는 기법을 토대로 함
  - 어떤 정보를 얻느냐에 따라 증상에 초점을 맞출 수 있고, 원인에 초점을 맞출 수 있다.
- 원격으로 디버깅을 수행할 때는 화이트박스 모니터링이 필수적
- 아직 발생하지 않았지만 곧 발생할 문제에 블랙박스 모니터링은 거의 도움이 되지 못한다.
  - 블랙박스 모니터링은 "현재"의 상황을 토대로 하니까?

### 결정적인 지표
1. 지연응답
   1. 지연 응답을 계산할 때, 에러 응답을 포함해서는 안되며 빠르게 리턴된 에러보다는 느리게 리턴된 에러가 더 중요하다.
2. 트래픽
   1. 서비스에 따라 다른 기준으로 측정할 수 있다.
   2. 요청의 성질로 나누어 분류할 수 있다.
3. 에러
   1. 명시적, 묵시적, 정책과 관련된 실패를 모두 고려해야 한다.
   2. 로드밸런서를 통해 HTTP 에러를 검출하면 실패한 요청들을 모두 완벽하게 잡아낼 수 있다.
4. 서비스 포화 상태
   1. 시스템의 일부를 측정하며 가장 병목이 발생하는 리소스를 집중해서 측정해야 한다.
   2. 긴급한 서비스 상황을 미리 예측하는 것과 관련이 깊다.
- 이 지표들 중 하나라도 문제가 될 수준일 때 사람을 호출할 수 있다.
### 
- 전체 요청에 대한 지연을 파악하기 위해서는 분포를 확인하는 것이 도움이 될 수 있다.
- 더 자주 상태를 확인한다고 해서 항상 의미가 있는 것은 아니다.
  - 세밀한 수집과 분석은 비용을 높인다.
- 극단적으로 낮은 지연이 필요하지 않다면, 서버 내부 샘플링 수행 후 시계열로 집계하는 외부 시스템을 구성하여 비용을 줄일 수 있다.
- 모니터링 시스템도 복잡도가 높아지면 장애가 발생하기 쉽고, 변경 사항을 수용하기 어려워지기에 최대한 **간결**해야 한다.
- 모니터링에 너무 많은 결과를 섞으면 시스템이 복잡해져서 결함이 생기기 쉽다.
- 호출에 대해 자동화 의지가 없다는 것은, 팀이 스스로 만든 기술 부채를 해소하는 데 자신이 없다는 것을 암시한다.
- 개별 장애 호출을 각기 다륵 보지 않고 전체적으로 보아야 한다.
- 이메일 알림은 그다지 큰 가치를 제공하지 못할 수 있으니, 대시보드의 형태가 권장된다.
- 대시보드를 로그와 결합하면 시간순으로 발생한 이벤트들의 연관 관계를 분석할 수 있다.

## Questions

## Thoughts
정처기 공부할 때 화이트박스 테스팅 기법이 코드나 서비스 구조 중심, 블랙박스 테스팅 기법이 사용자 중심 테스팅 기법이라고 배웠는데, 화이트박스, 블랙박스 모니터링도 이와 비슷한 속성을 토대로 한 것인가?

## Difficulties
- 원격으로 디버깅을 수행할 때는 화이트박스 모니터링이 필수적이라는데 어떤 상관이 있는건지 잘 모르겠다..

## References
<!-- 추가 찾아본 레퍼런스 -->

## Discussion Topics
<!-- 다른 사람의 의견이 궁금한 부분 -->